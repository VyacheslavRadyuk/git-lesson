<aura:component implements="force:appHostable,flexipage:availableForAllPageTypes" access="global" controller="TouristAssignmentController">
    <aura:attribute name="dataTrip" type="List" access="public"/>
    <aura:attribute name="columnsTrip" type="List" access="public"/>
    <aura:attribute name="selectedTourist" type="Id" access="public"/>
    <aura:attribute name="selectedTrip" type="Trip__c" access="public"/>
    <aura:attribute name="mapMarkers" type="List" access="public"/>
    <aura:attribute name="isNoActiveButton" type="boolean" default="false" access="public"/>
    <aura:attribute name="isActiveGeolocationOfSpacePoint" type="boolean" default="true" access="public"/>
    <aura:attribute name="isRefreshApp" type="boolean" default="false" access="public"/>
    <aura:attribute name="date" type="date" access="public"/>
    <aura:attribute name="averageTemperature" type="decimal" access="public"/>
    <aura:attribute name="countOccupiedSeats" type="integer" access="public"/>
    <aura:attribute name="isRefreshTripDatatable" type="boolean" default="false" access="public"/>
    
    <aura:handler name="init" value="{!this}" action="{!c.doInit}"/>
    <aura:handler name="change" value="{!v.selectedTourist}" action="{!c.doSelectRecordTourist}"/>

    <lightning:layout>
        <aura:if isTrue='{!(!v.isRefreshApp)}'>
        <lightning:layoutItem size="4" class="slds-p-around_x-small">   
            <lightning:card iconName="standard:contact" title="Select a tourist for the trip">
                <l_lookup:Lookup objectType="Tourist__c" 
                                 selectedRecordId="{!v.selectedTourist}"
                                 queryCondition="Active__c = true"/>    
                <div class="slds-m-top_small">
                    <lightning:button variant="brand" label="Submit" onclick="{!c.handleClick}" disabled="{!v.isNoActiveButton}"/>     
                </div>
            </lightning:card>          
        </lightning:layoutItem>
        </aura:if>
        
        <aura:if isTrue="{!and(v.selectedTourist.length > 0, v.isRefreshTripDatatable == false)}">
            <lightning:layoutItem size="4" class="slds-p-around_x-small">    
                <lightning:card iconName="standard:contact" title="Select a trip">
                    <lightning:datatable aura:id="tripTable"
                                         keyField="id"
                                         data="{!v.dataTrip}"
                                         columns="{!v.columnsTrip}"
                                         onrowselection="{!c.doSelectRecordTrip}"
                                         maxRowSelection="1"
                                         /> 
                    <aura:if isTrue="{!and(v.selectedTrip.length > 0, v.selectedTrip != null)}">
                        <lightning:card iconName="standard:contact" title="Trip information">
                            <div class="slds-m-left_small">
                                <p><b>Trip name: </b>{!v.selectedTrip[0].Name}</p>
                                <p><b>End Date: </b>{!v.selectedTrip[0].End_Date__c}</p>
                                <p><b>Minimum Age: </b>{!v.selectedTrip[0].Minimum_Age__c}</p>
                                <p><b>Seats: </b>{!v.countOccupiedSeats} of {!v.selectedTrip[0].Seats__c}</p>
                            </div>
                        </lightning:card>
                    </aura:if>
                </lightning:card>    
            </lightning:layoutItem> 
        </aura:if>
        <aura:if isTrue="{!and(v.selectedTrip.length > 0, v.isActiveGeolocationOfSpacePoint == true)}">
            <lightning:layoutItem size="4" class="slds-p-around_x-small">
                <lightning:card iconName="standard:contact" title="Spacepoint geolocation">
                    <lightning:map 
                                   mapMarkers="{! v.mapMarkers }"
                                   zoomLevel="7"/>
                    <aura:set attribute="footer">
                        Date: <lightning:badge label="{!v.date}"/>
                        Average Tempetarure: <lightning:badge label="{!v.averageTemperature}"/>
                    </aura:set> 
                </lightning:card>
            </lightning:layoutItem>
        </aura:if>
    </lightning:layout>
    
</aura:component>